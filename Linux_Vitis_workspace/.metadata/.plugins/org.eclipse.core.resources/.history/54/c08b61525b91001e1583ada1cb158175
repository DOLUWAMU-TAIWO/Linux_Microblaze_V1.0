#include <stdio.h>
#include "xparameters.h"
#include "xgpio.h"
#include "xil_printf.h"
#include "xuartlite.h"

#define GPIO_DEVICE_ID XPAR_AXI_GPIO_SEVEN_DEVICE_ID
#define UART_DEVICE_ID XPAR_AXI_UARTLITE_0_DEVICE_ID

// Pattern for displaying the number 1 (modify this based on your seven-segment wiring)
#define DIGIT_ONE 0b00110000  // Assuming 'b' and 'c' segments are for displaying '1'

XGpio Gpio;
XUartLite UartLite;

int InitializeUartLite(u16 DeviceId);
int InitializeGpio(u16 DeviceId);

int main() {
    int Status;

    xil_printf("Initializing UART...\r\n");
    Status = InitializeUartLite(UART_DEVICE_ID);
    if (Status != XST_SUCCESS) {
        xil_printf("UART initialization failed\r\n");
        return XST_FAILURE;
    }

    xil_printf("Initializing GPIO for seven-segment...\r\n");
    Status = InitializeGpio(GPIO_DEVICE_ID);
    if (Status != XST_SUCCESS) {
        xil_printf("GPIO initialization failed\r\n");
        return XST_FAILURE;
    }

    xil_printf("Displaying digit 1 on seven-segment...\r\n");
    XGpio_DiscreteWrite(&Gpio, 1, DIGIT_ONE);

    return 0;
}

int InitializeUartLite(u16 DeviceId) {
    int Status;

    Status = XUartLite_Initialize(&UartLite, DeviceId);
    if (Status != XST_SUCCESS) {
        return XST_FAILURE;
    }

    XUartLite_ResetFifos(&UartLite);

    return XST_SUCCESS;
}

int InitializeGpio(u16 DeviceId) {
    int Status;

    Status = XGpio_Initialize(&Gpio, DeviceId);
    if (Status != XST_SUCCESS) {
        return XST_FAILURE;
    }

    // Assuming channel 1 is connected to the segments
    XGpio_SetDataDirection(&Gpio, 1, 0x00); // Set all pins of channel 1 as output

    return XST_SUCCESS;
}
